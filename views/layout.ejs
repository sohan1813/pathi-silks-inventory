<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pathi Silks Inventory</title>

  <!-- Playfair Display (Global Font) -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- keep /public because server mounts static at /public -->
  <link rel="stylesheet" href="/public/style.css" />

  <!-- Favicons (optional but good branding) -->
  <link rel="icon" href="/public/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/public/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/public/favicon-16x16.png" sizes="16x16">
  <link rel="apple-touch-icon" href="/public/apple-touch-icon.png">

  <link rel="manifest" href="/public/manifest.webmanifest" />
  <meta name="theme-color" content="#201a2c" />
</head>
<body>
  <% if (typeof isAdmin === 'undefined') { isAdmin = false; } %>

  <!-- Background wrapper -->
  <div class="page">
    <div class="page-bg"></div>

    <div class="page-inner">
      <header>
        <div class="header-left">
          <img src="/public/pathi-logo.jpg" alt="Pathi Silks logo" class="header-logo">
          <div class="header-title">Pathi Silks Inventory</div>
        </div>

        <nav>
          <% if (!isAdmin) { %>
            <!-- Removed 4 links (Main/Other/Sales/Sheets). Only keep what is not in cards -->
            <a href="/purchases">ğŸ“¦ Stock Purchase</a>
          <% } %>

          <% if (isAdmin) { %>
            <a href="/admin-gallery">ğŸ“¸ Admin Gallery</a>
            <a href="/admin-main-gallery">ğŸ“¸ Admin Main</a>
            <a href="/admin-other-gallery">ğŸ—‚ï¸ Admin Other</a>
            <a href="/admin-sales-gallery">ğŸ’° Admin Sales</a>
            <a href="/admin-sheets">ğŸ“Š Admin Sheets</a>
            <a href="/upload">â¬†ï¸ Upload</a>
          <% } %>

          <!-- âœ… Theme toggle now global (shows on login also) -->
          <button id="themeToggle" class="install-btn" type="button">ğŸŒ™ Dark</button>

          <a href="/logout">ğŸšª Logout</a>
          <button id="installAppBtn" class="install-btn" style="display:none;">Install app</button>
        </nav>
      </header>

      <main>
        <%- typeof body === 'string' ? body : '' %>
      </main>

      <!-- Image lightbox -->
      <div id="lightbox" class="lightbox">
        <span id="lightbox-close" class="lightbox-close">&times;</span>
        <span id="lightbox-prev" class="lightbox-arrow lightbox-prev">â®</span>
        <span id="lightbox-next" class="lightbox-arrow lightbox-next">â¯</span>
        <div class="lightbox-content">
          <img id="lightbox-img" src="" alt="">
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Scroll-to-top button (bottom edge) -->
  <button id="scrollTopBtn" class="scroll-top-btn" type="button" aria-label="Scroll to top">â†‘</button>

  <script src="/public/lightbox.js"></script>

  <script>
    // âœ… Global Theme toggle: light -> dark -> brown -> blue -> light (persist in localStorage)
    (function () {
      const themeBtn = document.getElementById('themeToggle');
      const themes = ['light', 'dark', 'brown', 'blue'];
      const labels = {
        light: 'ğŸŒ™ Dark',
        dark: 'ğŸ¤ Brown',
        brown: 'ğŸ’™ Blue',
        blue: 'â˜€ï¸ Light',
      };

      function applyTheme(theme) {
        document.body.classList.remove('dark-mode', 'brown-mode', 'blue-mode');

        if (theme === 'dark') document.body.classList.add('dark-mode');
        if (theme === 'brown') document.body.classList.add('brown-mode');
        if (theme === 'blue') document.body.classList.add('blue-mode');

        if (themeBtn) themeBtn.textContent = labels[theme] || 'ğŸŒ™ Dark';
        localStorage.setItem('theme', theme);
      }

      let current = localStorage.getItem('theme') || 'light';
      if (!themes.includes(current)) current = 'light';
      applyTheme(current);

      if (themeBtn) {
        themeBtn.addEventListener('click', () => {
          const idx = themes.indexOf(current);
          const next = themes[(idx + 1) % themes.length];
          current = next;
          applyTheme(current);
        });
      }
    })();
  </script>

  <script>
    // âœ… Scroll-to-top behavior (show after scrolling + smooth scroll)
    (function () {
      const btn = document.getElementById('scrollTopBtn');
      if (!btn) return;

      window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
          btn.classList.add('scroll-top-btn--show');
        } else {
          btn.classList.remove('scroll-top-btn--show');
        }
      });

      btn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    })();
  </script>

  <script>
    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/public/sw.js');
    }

    // Custom install button handling
    let deferredInstallPrompt = null;
    const installBtn = document.getElementById('installAppBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredInstallPrompt = e;
      if (installBtn) installBtn.style.display = 'inline-block';
    });

    if (installBtn) {
      installBtn.addEventListener('click', async () => {
        if (!deferredInstallPrompt) return;
        deferredInstallPrompt.prompt();
        await deferredInstallPrompt.userChoice;
        deferredInstallPrompt = null;
        installBtn.style.display = 'none';
      });
    }
  </script>
</body>
</html>
