<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pathi Silks Inventory</title>

  <!-- keep /public because server mounts static at /public -->
  <link rel="stylesheet" href="/public/style.css" />

  <!-- Favicons (optional but good branding) -->
  <link rel="icon" href="/public/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/public/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/public/favicon-16x16.png" sizes="16x16">
  <link rel="apple-touch-icon" href="/public/apple-touch-icon.png">

  <link rel="manifest" href="/public/manifest.webmanifest" />
  <meta name="theme-color" content="#201a2c" />
</head>
<body>
  <% if (typeof isAdmin === 'undefined') { isAdmin = false; } %>

  <!-- Background wrapper -->
  <div class="page">
    <div class="page-bg"></div>

    <div class="page-inner">
      <header>
        <div class="header-left">
          <img src="/public/pathi-logo.jpg" alt="Pathi Silks logo" class="header-logo">
          <div class="header-title">Pathi Silks Inventory</div>
        </div>

        <nav>
          <% if (!isAdmin) { %>
            <!-- Removed 4 links (Main/Other/Sales/Sheets). Only keep what is not in cards -->
            <a href="/purchases">ğŸ“¦ Stock Purchase</a>
          <% } %>

          <% if (isAdmin) { %>
            <a href="/admin-gallery">ğŸ“¸ Admin Gallery</a>
            <a href="/admin-main-gallery">ğŸ“¸ Admin Main</a>
            <a href="/admin-other-gallery">ğŸ—‚ï¸ Admin Other</a>
            <a href="/admin-sales-gallery">ğŸ’° Admin Sales</a>
            <a href="/admin-sheets">ğŸ“Š Admin Sheets</a>
            <a href="/upload">â¬†ï¸ Upload</a>
          <% } %>

          <a href="/logout">ğŸšª Logout</a>
          <button id="installAppBtn" class="install-btn" style="display:none;">Install app</button>
        </nav>
      </header>

      <main>
        <%- typeof body === 'string' ? body : '' %>
      </main>

      <!-- Image lightbox -->
      <div id="lightbox" class="lightbox">
        <span id="lightbox-close" class="lightbox-close">&times;</span>
        <span id="lightbox-prev" class="lightbox-arrow lightbox-prev">â®</span>
        <span id="lightbox-next" class="lightbox-arrow lightbox-next">â¯</span>
        <div class="lightbox-content">
          <img id="lightbox-img" src="" alt="">
        </div>
      </div>
    </div>
  </div>

  <script src="/public/lightbox.js"></script>

  <script>
    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/public/sw.js');
    }

    // Custom install button handling
    let deferredInstallPrompt = null;
    const installBtn = document.getElementById('installAppBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredInstallPrompt = e;
      if (installBtn) installBtn.style.display = 'inline-block';
    });

    if (installBtn) {
      installBtn.addEventListener('click', async () => {
        if (!deferredInstallPrompt) return;
        deferredInstallPrompt.prompt();
        await deferredInstallPrompt.userChoice;
        deferredInstallPrompt = null;
        installBtn.style.display = 'none';
      });
    }
  </script>
</body>
</html>
